<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 주택청약 로드맵 | 20대 커플 맞춤형 가이드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Foundation (Warm neutrals like bg-amber-50, with a deep teal or blue for accents) -->
    <!-- Application Structure Plan: A single-page, vertical scrolling "roadmap" application. The structure follows a logical user journey for a real estate novice: 1. Assess current situation (My Status), 2. Learn the winning strategy (Strategy), 3. Simulate the financial burden (Simulator), 4. Get a final action plan (Checklist). This task-oriented flow is more usable than mirroring the report's structure, as it guides the user from self-assessment to a concrete plan, answering "What does this mean for ME?" at each step. -->
    <!-- Visualization & Content Choices: 1. Gajeom Calculator (HTML/JS): Goal=Inform. Shows low points to justify focusing on lottery. 2. Comparison Toggles (HTML/JS): Goal=Compare. Visually guides user to '민영주택', '생애최초'. Justification=Simplifies complex choices. 3. Loan Limit Bar Chart (Chart.js): Goal=Inform. Visualizes max debt based on DSR. Justification=Makes abstract DSR rule concrete. 4. Price Breakdown Donut Chart (Chart.js): Goal=Relationships. Shows how their savings, loan, and a potential shortfall relate to the total home price. Justification=Instant financial reality check. 5. Hidden Costs Stacked Bar (Chart.js): Goal=Inform/Warn. Aggregates all extra costs to show the true financial target. Justification=Prevents common homebuyer mistake. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        html { scroll-behavior: smooth; }
        .sticky-nav { position: -webkit-sticky; position: sticky; top: 0; z-index: 10; }
        .tab-button.active { border-color: #0d9488; color: #0d9488; font-weight: 700; background-color: #f0fdfa;}
        .tab-button { border-color: #e5e7eb; color: #6b7280; }
        .slider-thumb::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: #0d9488; cursor: pointer; border-radius: 50%; }
        .slider-thumb::-moz-range-thumb { width: 24px; height: 24px; background: #0d9488; cursor: pointer; border-radius: 50%; }
    </style>
</head>
<body class="bg-amber-50 text-gray-800">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky-nav">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                <div class="flex items-center space-x-2">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.496 2.132a1 1 0 00-.992 0l-7 4A1 1 0 003 8v10a1 1 0 001 1h12a1 1 0 001-1V8a1 1 0 00-.504-1.868l-7-4zM10 12a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                     </svg>
                    <h1 class="text-xl font-bold text-gray-800">내 집 마련 로드맵</h1>
                </div>
                <div class="hidden md:flex items-center space-x-6 text-sm font-medium text-gray-600">
                    <a href="#status" class="hover:text-teal-600">1. 현재상황 진단</a>
                    <a href="#strategy" class="hover:text-teal-600">2. 당첨전략 수립</a>
                    <a href="#simulation" class="hover:text-teal-600">3. 자금계획 시뮬레이션</a>
                    <a href="#checklist" class="hover:text-teal-600">4. 최종 실행계획</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <section class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold text-teal-700 mb-4">28세 & 25세 커플을 위한 주택청약 완벽 가이드</h2>
            <p class="max-w-3xl mx-auto text-lg text-gray-600">
                두 분의 소득과 자산 상황에 맞춰, 복잡한 청약 제도를 한눈에 이해하고 가장 현실적인 내 집 마련 전략을 세워 드립니다.
                <br>막막했던 청약 준비, 이 로드맵과 함께라면 어렵지 않습니다.
            </p>
        </section>
        
        <!-- 1. 현재상황 진단 -->
        <section id="status" class="mb-20">
            <h3 class="text-2xl font-bold mb-2">STEP 1. 우리의 현재상황 진단하기</h3>
            <p class="text-gray-600 mb-8">내 집 마련의 첫걸음은 우리의 현재 위치를 정확히 아는 것입니다. 두 분의 재정 상태와 청약 가점을 객관적으로 살펴봅시다.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-bold text-lg mb-4 text-teal-700">🔍 재정 현황 (Financial Status)</h4>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-teal-50 rounded-md">
                            <span class="font-medium">👫 합산 연 소득</span>
                            <span class="font-bold text-xl">약 8,500 만원</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-teal-50 rounded-md">
                            <span class="font-medium">💰 총 저축액</span>
                            <span class="font-bold text-xl">6,000 만원</span>
                        </div>
                         <div class="flex justify-between items-center p-3 bg-teal-50 rounded-md">
                            <span class="font-medium">🏦 청약통장 (각 600만원)</span>
                            <span class="font-bold text-xl">총 1,200 만원</span>
                        </div>
                    </div>
                    <p class="mt-4 text-sm text-gray-500">두 분의 성실함이 돋보이는 훌륭한 출발점입니다. 이 자산을 어떻게 활용할지가 관건입니다.</p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-bold text-lg mb-4 text-teal-700">📊 청약 가점 계산 결과</h4>
                    <div class="text-center p-4 bg-red-50 rounded-md">
                        <p class="text-gray-600">현재 두 분의 예상 청약 가점은...</p>
                        <p class="text-6xl font-extrabold text-red-500 my-2">10점 미만</p>
                        <p class="font-semibold text-red-700">가점제 당첨은 현실적으로 어렵습니다.</p>
                    </div>
                    <div class="mt-4 text-sm text-gray-500 space-y-1">
                        <p><strong>• 무주택기간 (0점):</strong> 미혼자는 만 30세부터 계산되어 현재 0점입니다.</p>
                        <p><strong>• 부양가족 수 (0점):</strong> 법적 부부가 아니고 자녀가 없어 0점입니다.</p>
                        <p><strong>• 청약통장 가입기간 (3~5점):</strong> 사회초년생으로 가입기간이 짧아 점수가 낮습니다.</p>
                        <p class="mt-2 pt-2 border-t">💡 <strong>핵심:</strong> 서울 인기 단지 당첨선은 60점대 후반입니다. 우리는 점수 경쟁인 '가점제'가 아닌, 운으로 뽑는 '추첨제'를 노려야 합니다.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. 당첨전략 수립 -->
        <section id="strategy" class="mb-20">
            <h3 class="text-2xl font-bold mb-2">STEP 2. 당첨 확률 높이는 맞춤 전략</h3>
            <p class="text-gray-600 mb-8">가점이 낮아도 괜찮습니다. 우리에게 맞는 경기장에서, 우리에게 유리한 규칙으로 승부하면 됩니다. 핵심 전략을 알아봅시다.</p>
            
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <div id="strategy-tabs" class="flex border-b mb-6">
                    <button data-tab="strategy1" class="tab-button flex-1 py-2 px-4 text-center border-b-2 active">전략 1: 추첨제 공략</button>
                    <button data-tab="strategy2" class="tab-button flex-1 py-2 px-4 text-center border-b-2">전략 2: 특별공급 선택</button>
                    <button data-tab="strategy3" class="tab-button flex-1 py-2 px-4 text-center border-b-2">전략 3: 결혼 메리트 활용</button>
                </div>

                <div id="strategy-content">
                    <div data-content="strategy1" class="tab-content">
                        <h4 class="font-bold text-xl mb-3 text-teal-800">민영주택의 '추첨제'가 우리의 유일한 길</h4>
                        <p class="mb-4">청약은 크게 '국민주택'과 '민영주택'으로 나뉩니다. 우리는 어떤 것을 선택해야 할까요?</p>
                        <div class="grid md:grid-cols-2 gap-4 text-center">
                            <div class="border-2 border-red-200 p-4 rounded-lg bg-red-50/50">
                                <h5 class="font-bold text-lg text-red-700">❌ 국민주택</h5>
                                <p class="text-sm">납입 횟수와 총액 순으로 당첨자를 뽑아 수십 년간 저축한 장기 가입자에게 절대적으로 불리합니다.</p>
                            </div>
                            <div class="border-2 border-green-200 p-4 rounded-lg bg-green-50/50">
                                <h5 class="font-bold text-lg text-green-700">✅ 민영주택</h5>
                                <p class="text-sm">가점과 상관없이 운으로 뽑는 **'추첨제' 물량**이 있어 우리에게 기회가 있습니다. 비규제지역 85㎡ 초과 평형은 100% 추첨제도 있습니다.</p>
                            </div>
                        </div>
                        <div class="mt-6 p-4 bg-teal-50 rounded-lg">
                            <p class="font-bold">💡 실천 계획: 청약통장 운용법 변경!</p>
                            <p class="text-sm text-gray-700">민영주택은 예치금 기준(서울 300만원)만 넘기면 됩니다. 이미 기준을 충족했으니 월 납입액을 2~10만원으로 최소화하고, 남는 돈은 '계약금 통장'에 따로 저축해 현금 자산을 확보하는 것이 훨씬 중요합니다.</p>
                        </div>
                    </div>

                    <div data-content="strategy2" class="tab-content hidden">
                        <h4 class="font-bold text-xl mb-3 text-teal-800">'생애최초 특별공급'이 최고의 카드</h4>
                        <p class="mb-4">특별공급은 일반공급보다 경쟁률이 낮아 당첨 확률이 높습니다. 우리에게 가장 유리한 특공은 무엇일까요?</p>
                         <div class="grid md:grid-cols-2 gap-4 text-center">
                            <div class="border-2 border-red-200 p-4 rounded-lg bg-red-50/50">
                                <h5 class="font-bold text-lg text-red-700">❌ 신혼부부 특공</h5>
                                <p class="text-sm">'자녀 수'가 당락을 결정하는 핵심 요소입니다. 자녀가 없는 현재 상황에서는 1순위가 될 수 없어 당첨 가능성이 매우 낮습니다.</p>
                            </div>
                            <div class="border-2 border-green-200 p-4 rounded-lg bg-green-50/50">
                                <h5 class="font-bold text-lg text-green-700">✅ 생애최초 특공</h5>
                                <p class="text-sm">평생 집을 산 적 없는 사람들을 대상으로 하며, **100% 추첨**으로 당첨자를 선정합니다. 자녀 유무와 상관없어 우리에게 압도적으로 유리합니다.</p>
                            </div>
                        </div>
                        <div class="mt-6 p-4 bg-teal-50 rounded-lg">
                            <p class="font-bold">💡 핵심 조건 확인</p>
                            <p class="text-sm text-gray-700">생애최초 특공은 혼인 중이거나 미혼 자녀가 있어야 하며, 과거 5개년 소득세 납부 실적이 필요합니다. 두 분 모두 이 조건을 충족하는지 미리 확인해야 합니다.</p>
                        </div>
                    </div>
                    
                    <div data-content="strategy3" class="tab-content hidden">
                        <h4 class="font-bold text-xl mb-3 text-teal-800">결혼, 이제는 페널티가 아닌 '메리트'</h4>
                        <p class="mb-4">2024년 3월부터 청약 제도가 바뀌면서, 혼인신고는 당첨 확률을 극적으로 높이는 최고의 전략이 되었습니다.</p>
                        <div class="p-6 bg-green-50 border-2 border-green-200 rounded-lg space-y-3">
                            <p class="text-lg font-semibold text-green-800">🎉 부부 중복청약 허용: 당첨 기회 2배!</p>
                            <p>이제 같은 단지에 부부가 각각 청약 신청이 가능합니다. 남편은 A타입, 아내는 B타입에 지원해 당첨 확률을 2배로 높일 수 있습니다. 이는 혼인신고를 해야만 누릴 수 있는 가장 강력한 혜택입니다.</p>
                             <p class="text-sm text-gray-600 pt-2 border-t border-green-200">이 외에도 배우자 통장 가입기간 합산(최대 3점), 맞벌이 소득기준 완화 등 결혼의 이점이 크게 늘었습니다.</p>
                        </div>
                         <div class="mt-6 p-4 bg-teal-50 rounded-lg">
                            <p class="font-bold">💡 전략적 결론</p>
                            <p class="text-sm text-gray-700">내 집 마련을 진지하게 생각한다면, 청약 신청 전에 혼인신고를 하여 법적 부부가 되는 것이 당첨을 위한 가장 현명하고 확실한 선택입니다.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. 자금계획 시뮬레이션 -->
        <section id="simulation" class="mb-20">
            <h3 class="text-2xl font-bold mb-2">STEP 3. 우리만의 자금계획 시뮬레이션</h3>
            <p class="text-gray-600 mb-8">당첨만큼 중요한 것이 자금 조달 계획입니다. 원하는 아파트 분양가를 설정하고, 우리가 감당할 수 있는지 현실적으로 점검해봅시다.</p>

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <div class="mb-8">
                    <label for="price-slider" class="block font-bold text-lg mb-2">1. 목표 아파트 분양가 설정하기</label>
                    <input id="price-slider" type="range" min="3" max="10" value="5" step="0.5" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    <div class="text-center mt-2">
                        <span class="text-3xl font-bold text-teal-700" id="price-display">5 억원</span>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-bold text-lg mb-4">2. 필요 자금 분석 (분양가 기준)</h4>
                        <div class="space-y-3">
                            <div class="p-4 rounded-lg bg-gray-100">
                                <p class="font-semibold">계약금 (10%)</p>
                                <p class="text-2xl font-bold text-red-600" id="down-payment">5,000 만원</p>
                                <p class="text-sm text-gray-600">오직 현금으로 준비해야 하는 첫 관문입니다.</p>
                                <div class="mt-2 text-sm" id="down-payment-status"></div>
                            </div>
                             <div class="p-4 rounded-lg bg-gray-100">
                                <p class="font-semibold">중도금 (60%)</p>
                                <p class="text-2xl font-bold" id="interim-payment">3 억원</p>
                                <p class="text-sm text-gray-600">'집단대출'로 해결. 단, 입주 시 이자를 한 번에 납부해야 합니다.</p>
                            </div>
                             <div class="p-4 rounded-lg bg-gray-100">
                                <p class="font-semibold">잔금 (30%)</p>
                                <p class="text-2xl font-bold" id="final-payment">1.5 억원</p>
                                <p class="text-sm text-gray-600">'주택담보대출'로 전환하여 해결합니다.</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-bold text-lg mb-4">3. 대출 가능 금액 확인 (DSR 40% 기준)</h4>
                        <p class="text-sm text-gray-600 mb-4">연 소득 8,500만원 기준, 모든 대출의 연 원리금 상환액이 연 소득의 40%(3,400만원)를 넘을 수 없습니다. 이것이 우리의 대출 한도를 결정합니다.</p>
                        <div class="chart-container">
                            <canvas id="loanLimitChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <hr class="my-10 border-t-2">

                <div>
                    <h4 class="font-bold text-lg mb-4 text-center">4. 최종 자금 계획: 내 돈, 대출, 그리고 숨겨진 비용</h4>
                    <p class="text-sm text-gray-600 mb-6 text-center max-w-2xl mx-auto">분양가 외에 취득세, 옵션 비용 등 추가 비용이 발생합니다. 이 모든 것을 고려한 최종 필요 자금을 확인해 보세요.</p>
                     <div class="chart-container" style="height:400px; max-height: 500px;">
                        <canvas id="totalCostChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. 최종 실행계획 -->
        <section id="checklist">
             <h3 class="text-2xl font-bold mb-2">STEP 4. 최종 액션 플랜 & 체크리스트</h3>
             <p class="text-gray-600 mb-8">이론과 시뮬레이션은 끝났습니다. 이제 실제 행동으로 옮길 차례입니다. 아래 체크리스트를 따라 차근차근 진행해 보세요.</p>
             <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg space-y-6">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-10 h-10 bg-teal-600 text-white rounded-full flex items-center justify-center font-bold text-lg">1</div>
                    <div>
                        <h4 class="font-bold text-lg">전략 확정 및 자금 관리</h4>
                        <ul class="list-disc list-inside text-gray-700 mt-2 space-y-1">
                            <li>[✅] 혼인신고 계획 세우기 (부부 중복청약 혜택)</li>
                            <li>[✅] 목표 설정: 민영주택 추첨제, 생애최초 특별공급</li>
                            <li>[✅] 청약통장 월 납입액 2~10만원으로 줄이기</li>
                            <li>[✅] '계약금 전용 통장' 개설 후 집중 저축 시작하기</li>
                        </ul>
                    </div>
                </div>
                 <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-10 h-10 bg-teal-600 text-white rounded-full flex items-center justify-center font-bold text-lg">2</div>
                    <div>
                        <h4 class="font-bold text-lg">정보 탐색 및 청약 신청</h4>
                        <ul class="list-disc list-inside text-gray-700 mt-2 space-y-1">
                            <li><a href="https://www.applyhome.co.kr" target="_blank" class="text-blue-600 hover:underline">'청약홈' 사이트에서 '청약알리미' 서비스 신청하기</a></li>
                            <li>관심 단지 입주자 모집공고문 꼼꼼히 읽기 (분양가, 중도금 조건, 전매제한 등)</li>
                            <li>부동산 앱(호갱노노, 아실 등)으로 주변 시세 및 입지 분석하기</li>
                             <li>부부가 각자 청약 신청하기 (당첨 확률 2배!)</li>
                        </ul>
                    </div>
                </div>
                 <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-10 h-10 bg-teal-600 text-white rounded-full flex items-center justify-center font-bold text-lg">3</div>
                    <div>
                        <h4 class="font-bold text-lg">당첨 후 자금 조달</h4>
                        <ul class="list-disc list-inside text-gray-700 mt-2 space-y-1">
                            <li>계약금 납부 (미리 확보한 현금으로!)</li>
                            <li>중도금 대출(집단대출) 신청 서류 준비</li>
                            <li>잔금 대출 알아보기 (1순위: 신혼부부 전용 디딤돌 대출)</li>
                            <li>숨겨진 비용(옵션, 취득세 등) 최종 예산 점검</li>
                        </ul>
                    </div>
                </div>
                 <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-10 h-10 bg-teal-600 text-white rounded-full flex items-center justify-center font-bold text-lg">4</div>
                    <div>
                        <h4 class="font-bold text-lg">입주 준비</h4>
                        <ul class="list-disc list-inside text-gray-700 mt-2 space-y-1">
                             <li>입주예정자 온라인 카페 가입하여 정보 얻고 공동 대응하기</li>
                             <li>사전점검 꼼꼼히 하여 하자보수 요청하기</li>
                             <li>최종 입주! 🎉</li>
                        </ul>
                    </div>
                </div>
             </div>
        </section>

    </main>
    
    <footer class="text-center py-8 px-4 text-sm text-gray-500">
        <p>본 애플리케이션은 제공된 정보를 바탕으로 한 일반적인 가이드이며, 실제 청약 및 대출 시에는 반드시 해당 기관의 공고 및 규정을 확인해야 합니다.</p>
        <p>&copy; 2025. Your Personalized Housing Roadmap. All rights reserved.</p>
    </footer>

    <script>
        const userProfile = {
            jointIncome: 85000000,
            currentSavings: 60000000,
        };

        const priceSlider = document.getElementById('price-slider');
        const priceDisplay = document.getElementById('price-display');
        
        const downPaymentEl = document.getElementById('down-payment');
        const interimPaymentEl = document.getElementById('interim-payment');
        const finalPaymentEl = document.getElementById('final-payment');
        const downPaymentStatusEl = document.getElementById('down-payment-status');

        let loanLimitChart, totalCostChart;

        const formatCurrency = (amount) => {
            if (amount >= 100000000) {
                const eok = Math.floor(amount / 100000000);
                const man = Math.floor((amount % 100000000) / 10000);
                return `${eok}억 ${man > 0 ? man + '만원' : ''}`.trim();
            } else {
                return `${Math.floor(amount / 10000)}만원`;
            }
        };
        
        const formatCurrencyShort = (amount) => {
             const eok = amount / 100000000;
             return `${eok.toFixed(1)} 억원`;
        }

        const calculateLoanLimit = () => {
            const annualIncome = userProfile.jointIncome;
            const dsrLimit = 0.4; // DSR 40%
            const loanTerm = 30; // 30년
            const stressRate = 0.015; // 스트레스 금리 1.5%
            const baseRate = 0.045; // 기준금리 4.5%
            const interestRate = baseRate + stressRate; // DSR 계산용 금리 (6.0%)

            const monthlyRate = interestRate / 12;
            const numberOfPayments = loanTerm * 12;
            const maxAnnualPayment = annualIncome * dsrLimit;
            const maxMonthlyPayment = maxAnnualPayment / 12;

            const maxLoanAmount = maxMonthlyPayment * ( (Math.pow(1 + monthlyRate, numberOfPayments) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) );
            
            return {
                maxLoanAmount: Math.floor(maxLoanAmount / 10000) * 10000,
                maxAnnualPayment,
            };
        };

        const updateSimulation = () => {
            const price = parseFloat(priceSlider.value) * 100000000;
            priceDisplay.textContent = formatCurrencyShort(price);

            const downPayment = price * 0.1;
            const interimPayment = price * 0.6;
            const finalPayment = price * 0.3;

            downPaymentEl.textContent = formatCurrency(downPayment);
            interimPaymentEl.textContent = formatCurrency(interimPayment);
            finalPaymentEl.textContent = formatCurrency(finalPayment);

            if (userProfile.currentSavings >= downPayment) {
                downPaymentStatusEl.innerHTML = `<span class="font-bold text-green-600">✓ 현재 저축액(${formatCurrency(userProfile.currentSavings)})으로 충분히 감당 가능합니다.</span>`;
            } else {
                const shortfall = downPayment - userProfile.currentSavings;
                downPaymentStatusEl.innerHTML = `<span class="font-bold text-red-600">✗ 계약금 마련을 위해 ${formatCurrency(shortfall)}이 더 필요합니다.</span>`;
            }

            updateCharts(price);
        };

        const createCharts = () => {
            const loanData = calculateLoanLimit();
            
            const loanCtx = document.getElementById('loanLimitChart').getContext('2d');
            loanLimitChart = new Chart(loanCtx, {
                type: 'bar',
                data: {
                    labels: ['최대 대출 가능 금액 (DSR 40%)'],
                    datasets: [{
                        label: '금액',
                        data: [loanData.maxLoanAmount],
                        backgroundColor: ['#14b8a6'],
                        borderColor: ['#0f766e'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        title: { display: true, text: '주택담보대출 최대 한도 (스트레스 DSR 적용)'},
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                callback: function(value, index, values) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });

            const totalCostCtx = document.getElementById('totalCostChart').getContext('2d');
            totalCostChart = new Chart(totalCostCtx, {
                type: 'bar',
                data: {
                    labels: ['총 필요 자금'],
                    datasets: [
                        { label: '분양가', data: [], backgroundColor: '#0d9488' },
                        { label: '취득세 등', data: [], backgroundColor: '#f97316' },
                        { label: '옵션(발코니+에어컨)', data: [], backgroundColor: '#eab308' },
                        { label: '중도금 이자', data: [], backgroundColor: '#ef4444' },
                        { label: '기타 비용', data: [], backgroundColor: '#6b7280' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true },
                        y: { 
                            stacked: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        title: { display: true, text: '분양가 외 숨겨진 비용 포함 총 필요 자금'},
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        };

        const updateCharts = (price) => {
            const downPayment = price * 0.1;
            const interimLoan = price * 0.6;
            
            const tax = (price * 0.011) - 2000000 > 0 ? (price * 0.011) - 2000000 : 0; // 5억 50만
            const options = 15000000 + 7000000; // 2200만
            const interimInterest = interimLoan * 0.05 * 2.5; // 3억*5%*2.5년 = 3750만
            const etc = 3000000 + 500000 + 5000000; // 850만

            totalCostChart.data.datasets[0].data = [price];
            totalCostChart.data.datasets[1].data = [tax];
            totalCostChart.data.datasets[2].data = [options];
            totalCostChart.data.datasets[3].data = [interimInterest];
            totalCostChart.data.datasets[4].data = [etc];
            totalCostChart.update();
        };

        const setupTabs = () => {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.dataset.tab;

                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    tabContents.forEach(content => {
                        if (content.dataset.content === tabId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });
        };
        
        window.onload = () => {
            createCharts();
            updateSimulation();
            setupTabs();
            priceSlider.addEventListener('input', updateSimulation);
        };
    </script>

</body>
</html>
